{% extends "base.html" %}

{% block title %}Todos los Gastos{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Todos los Gastos</h2>

    <div class="mt-3">
        <form method="GET" class="row g-3">
            <div class="col-auto">
                <label for="status" class="form-label">Filtrar por estado:</label>
            </div>
            <div class="col-auto">
                <select name="status" id="status" class="form-select" onchange="this.form.submit()">
                    <option value="all" {% if status_filter == 'all' %}selected{% endif %}>Todos</option>
                    <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>Pendientes</option>
                    <option value="approved" {% if status_filter == 'approved' %}selected{% endif %}>Aprobados</option>
                    <option value="rejected" {% if status_filter == 'rejected' %}selected{% endif %}>Rechazados</option>
                    <option value="reimbursed" {% if status_filter == 'reimbursed' %}selected{% endif %}>Reembolsados</option>
                </select>
            </div>
        </form>
    </div>

    {% if expenses %}
        <div class="table-responsive mt-3">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Empleado</th>
                        <th>Fecha</th>
                        <th>Categor√≠a</th>
                        <th>Monto</th>
                        <th>Cliente</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for expense in expenses %}
                    <tr>
                        <td>{{ expense.id }}</td>
                        <td>{{ expense.user.full_name }}</td>
                        <td>{{ expense.expense_date.strftime('%d/%m/%Y') }}</td>
                        <td>{{ expense.category }}</td>
                        <td>${{ "{:,.0f}".format(expense.amount) }}</td>
                        <td>{{ expense.client.name if expense.client else '-' }}</td>
                        <td>
                            <span class="badge
                                {% if expense.status == 'pending' %}bg-warning
                                {% elif expense.status == 'approved' %}bg-success
                                {% elif expense.status == 'rejected' %}bg-danger
                                {% elif expense.status == 'reimbursed' %}bg-info
                                {% endif %}">
                                {{ expense.status }}
                            </span>
                        </td>
                        <td>
                            <a href="{{ url_for('approvals.detail', expense_id=expense.id) }}"
                               class="btn btn-sm btn-info">Ver</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% if pagination %}
        <div class="mt-3">
            <strong>Total: </strong> {{ pagination.total }} gasto(s)
        </div>
        <div class="mt-4">
            {% include '_pagination.html' %}
        </div>
        {% endif %}
    {% else %}
        <div class="alert alert-info mt-3">
            No hay gastos con el filtro seleccionado.
        </div>
    {% endif %}

    <div class="mt-3">
        <a href="{{ url_for('approvals.pending') }}" class="btn btn-secondary">Ver Pendientes</a>
    </div>
</div>
{% endblock %}
